<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>작업능력지수(WAI) 설문지 (데이터 저장/출력 기능)</title>
    <style>
        body {
            font-family: "Inter", sans-serif;
            background: linear-gradient(to bottom, #f0f4f8, #ffffff);
            color: #333;
            line-height: 1.6;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
        }
        .container {
            max-width: 960px;
            width: 95%;
            margin: 2rem auto;
            padding: 2rem;
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }
        h1, h2, h3 {
            color: #2c3e50;
            font-weight: 700;
            margin-bottom: 1.0rem;
        }
        h1 {
            font-size: 2.5rem;
            text-align: center;
        }
        h2 {
            font-size: 1.22rem;
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 0.5rem;
            margin-top: 1.0rem;
            padding-left: 1rem;
        }
        /* 사용자 정보 섹션의 h2 스타일 재정의 */
        .user-info-section h2 {
            border-bottom: none;
            padding-left: 0;
            margin-top: 0;
            margin-bottom: 0.5rem;
        }
        h3 {
            font-size: 1.5rem;
            font-weight: 600;
            margin-top: 1.0rem;
            margin-bottom: 0.8rem;
            color: #34495e;
            padding-left: 1rem;
        }
        .user-info-section, .question-group-section, .question-section {
            margin-bottom: 1.0rem;
            padding: 0.8rem 1.0rem;
            background-color: #f8fafc;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }
        .question-group-section .question-section {
            margin-bottom: 0.5rem;
            padding: 0.5rem 0;
            border-bottom: 1px dashed #e2e8f0;
            background-color: transparent;
            border-radius: 0;
            border-left: none;
            border-right: none;
            border-top: none;
        }
        .question-group-section .question-section:last-child {
            margin-bottom: 0;
            border-bottom: none;
        }
        .question-title {
            font-weight: 600;
            margin-bottom: 0.8rem;
            color: #34495e;
            text-indent:-1.5rem;
            padding-left: 1.5rem;
        }
        .option-group label {
            display: flex;
            align-items: center;
            margin-bottom: 0.5rem;
            cursor: pointer;
            padding: 0.3rem 1rem;
            border-radius: 6px;
            transition: background-color 0.2s;
        }
        .option-group label:hover {
            background-color: #eef2f6;
        }
        input[type="radio"], input[type="checkbox"] {
            margin-right: 0.75rem;
            transform: scale(1.2);
        }
        .score-display {
            font-size: 1.5rem;
            font-weight: 700;
            text-align: center;
            margin-top: 1.5rem;
            padding: 1.5rem;
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 6px 25px rgba(0, 0, 0, 0.15);
            border: 1px solid #dcdfe4;
        }
        .score-display p { margin-bottom: 0.5rem; }
        .score-display #waiScore {
            font-size: 2.5rem;
            font-weight: 900;
            display: block;
            margin-top: 1rem;
            margin-bottom: 1rem;
            transition: color 0.3s ease;
        }
        .score-level {
            font-size: 1.8rem;
            font-weight: 700;
            margin-top: 0.5rem;
            margin-bottom: 1rem;
            transition: color 0.3s ease;
        }
        .excellent { color: #27ae60; }
        .good { color: #f1c40f; }
        .moderate { color: #f39c12; }
        .poor { color: #e74c3c; }
        .form-input {
            padding: 0.75rem;
            border: 1px solid #cbd5e0;
            border-radius: 6px;
            width: 100%;
            box-sizing: border-box;
            margin-bottom: 0.8rem;
            font-size: 1rem;
        }
        .checkbox-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 0.8rem;
        }
        .checkbox-table th, .checkbox-table td {
            border: 1px solid #e2e8f0;
            padding: 0.6rem 0.75rem;
            text-align: left;
        }
        .checkbox-table th { background-color: #f0f4f8; font-weight: 600; }
        .checkbox-table td input[type="radio"] { margin-right: 0.5rem; transform: scale(1.0); }
        .flex-row { display: flex; gap: 0.8rem; margin-bottom: 0.8rem; }
        .flex-row > div { flex: 1; }
        .individual-scores {
            margin-top: 1.5rem;
            text-align: left;
            font-size: 1.05rem;
            color: #555;
            padding: 1rem;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            background-color: #fcfdff;
        }
        .individual-scores p { margin-bottom: 0.6rem; }
        .individual-scores .detail { font-size: 0.95rem; color: #666; margin-left: 1.5rem; }
        .checkbox-table td:nth-child(2), .checkbox-table td:nth-child(3) { text-align: center; vertical-align: middle; }
        .wai-criteria-table {
            width: 100%;
            border-collapse: collapse;
            margin: 0.8rem auto;
            font-size: 1rem;
            border-radius: 8px;
            overflow: hidden;
            border: 2px solid black;
            max-width: 600px;
            table-layout: fixed;
        }
        .wai-criteria-table th, .wai-criteria-table td {
            border: 1px solid #666;
            padding: 0.5rem;
            text-align: center;
            vertical-align: middle;
            color: white;
        }
        .wai-criteria-table th { background-color: #6c757d; color: white; font-weight: 700; }
        .wai-criteria-table td { font-weight: normal; }
        .wai-criteria-table th:nth-child(1), .wai-criteria-table td:nth-child(1) { width: 15%; }
        .wai-criteria-table th:nth-child(2), .wai-criteria-table td:nth-child(2) { width: 30%; }
        .wai-criteria-table th:nth-child(3), .wai-criteria-table td:nth-child(3) { width: 55%; }
        .wai-criteria-table .excellent-row { background-color: #28a745; }
        .wai-criteria-table .good-row { background-color: #ffc107; color: #333; }
        .wai-criteria-table .moderate-row { background-color: #fd7e14; }
        .wai-criteria-table .poor-row { background-color: #dc3545; }
        .wai-criteria-table td:last-child { white-space: normal; word-break: break-word; }
        .button-container { display: flex; justify-content: center; flex-wrap: wrap; gap: 0.5rem; margin-top: 1.5rem; }
        .btn {
            color: white;
            font-weight: bold;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: background-color 0.3s ease, transform 0.3s ease;
            border: none;
            cursor: pointer;
        }
        .btn:hover { transform: scale(1.05); }
        .btn-calculate { background-color: #2196f3; }
        .btn-calculate:hover { background-color: #1976d2; }
        .btn-save { background-color: #4caf50; margin-left: 2rem; } /* 버튼 간격 추가 */
        .btn-save:hover { background-color: #43a047; }
        .btn-export { background-color: #ff9800; }
        .btn-export:hover { background-color: #fb8c00; }
        .btn-reset { background-color: #6c757d; }
        .btn-reset:hover { background-color: #5a6268; }
        .result-section-title { color: #2d3748; margin-top: 1rem; margin-bottom: 0.5rem; text-align: center; }
        .text-small-gray { font-size: 0.875rem; color: #718096; margin-bottom: 0.8rem; padding-left: 1rem; }
        .hidden { display: none; }
        .table-section-title { font-weight: bold; background-color: #f0f4f8; padding-left: 1rem; }
        .form-input-inline { padding: 0.3rem 0.5rem; border: 1px solid #cbd5e0; border-radius: 4px; width: 90%; box-sizing: border-box; margin-bottom: 0; }
        .fixed-message-box {
            position: fixed;
            top: 1rem;
            left: 50%;
            transform: translateX(-50%);
            padding: 1rem 1.5rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            color: white;
            min-width: 300px;
            text-align: center;
            display: none;
            font-size: 1rem;
            font-weight: 500;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>작업능력지수(WAI) 설문지</h1>
        <p class="text-center" style="margin-bottom: 1.5rem;">
            본 설문은 작업자의 작업수행능력을 평가하고, 작업능력을 유지시키고 건강을 증진하도록 하기 위한 기초자료(작업능력지수_Work Ability Index, WAI 산출)를 수집하기 위한 것입니다.
        </p>

        <!-- 사용자 정보 입력 -->
        <div class="user-info-section">
            <div class="flex-row">
                <div>
                    <h2>사업장명</h2>
                    <input type="text" id="companyName" class="form-input" placeholder="사업장명을 입력하세요">
                </div>
                <div>
                    <h2>부서(공정)명</h2>
                    <input type="text" id="departmentName" class="form-input" placeholder="부서 또는 공정명을 입력하세요">
                </div>
            </div>
        </div>

        <!-- Question Group 1: 1-1, 1-2, 1-3 -->
        <div class="question-group-section" id="q1_group_section">
            <div class="question-section" id="q1_1_section">
                <h2 class="question-title">1-1. 귀하의 일은 주로 어떤 형태입니까?</h2>
                <div class="option-group">
                    <label><input type="radio" name="q1_1_type" value="정신적인 일"> 정신적인 일</label>
                    <label><input type="radio" name="q1_1_type" value="육체적인 일"> 육체적인 일</label>
                    <label><input type="radio" name="q1_1_type" value="정신 및 육체적인 일 모두"> 정신 및 육체적인 일 반반</label>
                </div>
            </div>
            <div class="question-section" id="q1_2_section">
                <h2 class="question-title">1-2. 당신의 작업 중 <span style="text-decoration: underline;">육체적인 업무</span>에 대한 현재 자신의 작업능력을 어느 정도로 평가하십니까?</h2>
                <div class="option-group">
                    <label><input type="radio" name="q1_2_physical" value="5"> 매우 좋다</label>
                    <label><input type="radio" name="q1_2_physical" value="4"> 조금 좋다</label>
                    <label><input type="radio" name="q1_2_physical" value="3"> 보통이다</label>
                    <label><input type="radio" name="q1_2_physical" value="2"> 조금 나쁘다</label>
                    <label><input type="radio" name="q1_2_physical" value="1"> 매우 나쁘다</label>
                </div>
            </div>
            <div class="question-section" id="q1_3_section">
                <h2 class="question-title">1-3. 당신의 작업 중 <span style="text-decoration: underline;">정신적인 업무</span>에 대한 현재 자신의 작업능력을 어느 정도로 평가하십니까?</h2>
                <div class="option-group">
                    <label><input type="radio" name="q1_3_mental" value="5"> 매우 좋다</label>
                    <label><input type="radio" name="q1_3_mental" value="4"> 조금 좋다</label>
                    <label><input type="radio" name="q1_3_mental" value="3"> 보통이다</label>
                    <label><input type="radio" name="q1_3_mental" value="2"> 조금 나쁘다</label>
                    <label><input type="radio" name="q1_3_mental" value="1"> 매우 나쁘다</label>
                </div>
            </div>
        </div>

        <!-- Question 2 -->
        <div class="question-section" id="q2_section">
            <h2 class="question-title">2. 당신이 최고로 좋았을 때의 작업능력을 10점으로 가정한다면, 현재의 작업수행능력은 몇 점에 해당합니까?</h2>
            <div class="option-group">
                <label><input type="radio" name="q2_current_ability" value="10"> 10점 (최상)</label>
                <label><input type="radio" name="q2_current_ability" value="9"> 9점</label>
                <label><input type="radio" name="q2_current_ability" value="8"> 8점</label>
                <label><input type="radio" name="q2_current_ability" value="7"> 7점</label>
                <label><input type="radio" name="q2_current_ability" value="6"> 6점</label>
                <label><input type="radio" name="q2_current_ability" value="5"> 5점 (중간)</label>
                <label><input type="radio" name="q2_current_ability" value="4"> 4점</label>
                <label><input type="radio" name="q2_current_ability" value="3"> 3점</label>
                <label><input type="radio" name="q2_current_ability" value="2"> 2점</label>
                <label><input type="radio" name="q2_current_ability" value="1"> 1점</label>
                <label><input type="radio" name="q2_current_ability" value="0"> 0점 (불능)</label>
            </div>
        </div>

        <!-- Question 3 -->
        <div class="question-section" id="q3_section">
            <h2 class="question-title">3. 아래의 목록에 해당하는 질병이나 부상 중, 그 질병이나 부상이 자신의 생각인지 의사의 진단에 의한 것인지 표시하세요.</h2>
            <div class="option-group" style="margin-bottom: 1rem;">
                <label><input type="checkbox" id="q3_no_diagnosis"> <strong>자가 및 의사 진단 질병이나 부상 정보 해당 사항 없음</strong></label>
            </div>
            <p class="text-small-gray mb-4">(각 질병/부상 항목당 '자가진단' 또는 '의사진단' 중 하나만 선택할 수 있습니다.)</p>
            <div id="q3_table_container">
                <table class="checkbox-table">
                    <thead>
                        <tr>
                            <th>질병/부상</th>
                            <th>자가진단</th>
                            <th>의사진단</th>
                            <th>기타 (직접 입력)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td colspan="4" class="table-section-title">사고로 인한 부상</td></tr>
                        <tr><td>1. 등</td><td><input type="radio" name="q3_diag_1" value="self"></td><td><input type="radio" name="q3_diag_1" value="doc"></td><td></td></tr>
                        <tr><td>2. 팔/손</td><td><input type="radio" name="q3_diag_2" value="self"></td><td><input type="radio" name="q3_diag_2" value="doc"></td><td></td></tr>
                        <tr><td>3. 다리/발</td><td><input type="radio" name="q3_diag_3" value="self"></td><td><input type="radio" name="q3_diag_3" value="doc"></td><td></td></tr>
                        <tr><td>4. 기타 신체 부위</td><td><input type="radio" name="q3_diag_4" value="self"></td><td><input type="radio" name="q3_diag_4" value="doc"></td><td><input type="text" name="q3_etc_4" class="form-input-inline"></td></tr>
                        <tr><td colspan="4" class="table-section-title">근골격계질환</td></tr>
                        <tr><td>5. 위쪽 등이나 경추(목뼈) 질환</td><td><input type="radio" name="q3_diag_5" value="self"></td><td><input type="radio" name="q3_diag_5" value="doc"></td><td></td></tr>
                        <tr><td>6. 허리 질환, 통증의 발생이 반복함</td><td><input type="radio" name="q3_diag_6" value="self"></td><td><input type="radio" name="q3_diag_6" value="doc"></td><td></td></tr>
                        <tr><td>7. 허리에서 다리로 전파되는(뻗치는) 통증</td><td><input type="radio" name="q3_diag_7" value="self"></td><td><input type="radio" name="q3_diag_7" value="doc"></td><td></td></tr>
                        <tr><td>8. 사지의(팔, 다리) 근골격계질환, 통증의 발생이 반복함</td><td><input type="radio" name="q3_diag_8" value="self"></td><td><input type="radio" name="q3_diag_8" value="doc"></td><td></td></tr>
                        <tr><td>9. 류마티스성 관절염</td><td><input type="radio" name="q3_diag_9" value="self"></td><td><input type="radio" name="q3_diag_9" value="doc"></td><td></td></tr>
                        <tr><td>10. 기타 근골격계질환</td><td><input type="radio" name="q3_diag_10" value="self"></td><td><input type="radio" name="q3_diag_10" value="doc"></td><td><input type="text" name="q3_etc_10" class="form-input-inline"></td></tr>
                        <tr><td colspan="4" class="table-section-title">심혈관계질환</td></tr>
                        <tr><td>11. 고혈압</td><td><input type="radio" name="q3_diag_11" value="self"></td><td><input type="radio" name="q3_diag_11" value="doc"></td><td></td></tr>
                        <tr><td>12. 관상동맥질환, 운동 중 가슴 부위의 통증(협심증)</td><td><input type="radio" name="q3_diag_12" value="self"></td><td><input type="radio" name="q3_diag_12" value="doc"></td><td></td></tr>
                        <tr><td>13. 관상동맥 혈전증, 심근경색</td><td><input type="radio" name="q3_diag_13" value="self"></td><td><input type="radio" name="q3_diag_13" value="doc"></td><td></td></tr>
                        <tr><td>14. 심부전증</td><td><input type="radio" name="q3_diag_14" value="self"></td><td><input type="radio" name="q3_diag_14" value="doc"></td><td></td></tr>
                        <tr><td>15. 기타 관상동맥질환</td><td><input type="radio" name="q3_diag_15" value="self"></td><td><input type="radio" name="q3_diag_15" value="doc"></td><td><input type="text" name="q3_etc_15" class="form-input-inline"></td></tr>
                        <tr><td colspan="4" class="table-section-title">호흡기질환</td></tr>
                        <tr><td>16. 반복적인 호흡기 감염</td><td><input type="radio" name="q3_diag_16" value="self"></td><td><input type="radio" name="q3_diag_16" value="doc"></td><td></td></tr>
                        <tr><td>17. 만성기관지염</td><td><input type="radio" name="q3_diag_17" value="self"></td><td><input type="radio" name="q3_diag_17" value="doc"></td><td></td></tr>
                        <tr><td>18. 만성부비동염(축농증)</td><td><input type="radio" name="q3_diag_18" value="self"></td><td><input type="radio" name="q3_diag_18" value="doc"></td><td></td></tr>
                        <tr><td>19. 기관지 천식</td><td><input type="radio" name="q3_diag_19" value="self"></td><td><input type="radio" name="q3_diag_19" value="doc"></td><td></td></tr>
                        <tr><td>20. 폐기종</td><td><input type="radio" name="q3_diag_20" value="self"></td><td><input type="radio" name="q3_diag_20" value="doc"></td><td></td></tr>
                        <tr><td>21. 폐 결핵</td><td><input type="radio" name="q3_diag_21" value="self"></td><td><input type="radio" name="q3_diag_21" value="doc"></td><td></td></tr>
                        <tr><td>22. 기타 호흡기 질환</td><td><input type="radio" name="q3_diag_22" value="self"></td><td><input type="radio" name="q3_diag_22" value="doc"></td><td><input type="text" name="q3_etc_22" class="form-input-inline"></td></tr>
                        <tr><td colspan="4" class="table-section-title">정신질환</td></tr>
                        <tr><td>23. 정신질환이나 정신적 문제(예, 심한 우울증)</td><td><input type="radio" name="q3_diag_23" value="self"></td><td><input type="radio" name="q3_diag_23" value="doc"></td><td></td></tr>
                        <tr><td>24. 가벼운 정신질환이나 정신적 문제</td><td><input type="radio" name="q3_diag_24" value="self"></td><td><input type="radio" name="q3_diag_24" value="doc"></td><td></td></tr>
                        <tr><td colspan="4" class="table-section-title">신경질환</td></tr>
                        <tr><td>25. 청력 장애나 청력 손상</td><td><input type="radio" name="q3_diag_25" value="self"></td><td><input type="radio" name="q3_diag_25" value="doc"></td><td></td></tr>
                        <tr><td>26. 시각 장애나 시각 손상</td><td><input type="radio" name="q3_diag_26" value="self"></td><td><input type="radio" name="q3_diag_26" value="doc"></td><td></td></tr>
                        <tr><td>27. 신경학적 질환(예, 뇌졸중, 신경통, 편두통, 간질)</td><td><input type="radio" name="q3_diag_27" value="self"></td><td><input type="radio" name="q3_diag_27" value="doc"></td><td></td></tr>
                        <tr><td>28. 기타 신경 질환</td><td><input type="radio" name="q3_diag_28" value="self"></td><td><input type="radio" name="q3_diag_28" value="doc"></td><td><input type="text" name="q3_etc_28" class="form-input-inline"></td></tr>
                        <tr><td colspan="4" class="table-section-title">소화기질환</td></tr>
                        <tr><td>29. 담석이나 담도계 질환</td><td><input type="radio" name="q3_diag_29" value="self"></td><td><input type="radio" name="q3_diag_29" value="doc"></td><td></td></tr>
                        <tr><td>30. 간 또는 췌장 질환</td><td><input type="radio" name="q3_diag_30" value="self"></td><td><input type="radio" name="q3_diag_30" value="doc"></td><td></td></tr>
                        <tr><td>31. 위궤양이나 십이지장 궤양</td><td><input type="radio" name="q3_diag_31" value="self"></td><td><input type="radio" name="q3_diag_31" value="doc"></td><td></td></tr>
                        <tr><td>32. 위염이나 십이지장염</td><td><input type="radio" name="q3_diag_32" value="self"></td><td><input type="radio" name="q3_diag_32" value="doc"></td><td></td></tr>
                        <tr><td>33. 대장염</td><td><input type="radio" name="q3_diag_33" value="self"></td><td><input type="radio" name="q3_diag_33" value="doc"></td><td></td></tr>
                        <tr><td>34. 기타 소화기 질환</td><td><input type="radio" name="q3_diag_34" value="self"></td><td><input type="radio" name="q3_diag_34" value="doc"></td><td><input type="text" name="q3_etc_34" class="form-input-inline"></td></tr>
                        <tr><td colspan="4" class="table-section-title">비뇨생식기질환</td></tr>
                        <tr><td>35. 요로계 감염</td><td><input type="radio" name="q3_diag_35" value="self"></td><td><input type="radio" name="q3_diag_35" value="doc"></td><td></td></tr>
                        <tr><td>36. 신장(콩팥) 질환</td><td><input type="radio" name="q3_diag_36" value="self"></td><td><input type="radio" name="q3_diag_36" value="doc"></td><td></td></tr>
                        <tr><td>37. 생식기 질환(예, 나팔관염, 전립선염)</td><td><input type="radio" name="q3_diag_37" value="self"></td><td><input type="radio" name="q3_diag_37" value="doc"></td><td></td></tr>
                        <tr><td>38. 기타 비뇨생식기 질환</td><td><input type="radio" name="q3_diag_38" value="self"></td><td><input type="radio" name="q3_diag_38" value="doc"></td><td><input type="text" name="q3_etc_38" class="form-input-inline"></td></tr>
                        <tr><td colspan="4" class="table-section-title">피부질환</td></tr>
                        <tr><td>39. 알레르기 발진/습진</td><td><input type="radio" name="q3_diag_39" value="self"></td><td><input type="radio" name="q3_diag_39" value="doc"></td><td></td></tr>
                        <tr><td>40. 기타 발진</td><td><input type="radio" name="q3_diag_40" value="self"></td><td><input type="radio" name="q3_diag_40" value="doc"></td><td><input type="text" name="q3_etc_40" class="form-input-inline"></td></tr>
                        <tr><td>41. 기타 피부 질환</td><td><input type="radio" name="q3_diag_41" value="self"></td><td><input type="radio" name="q3_diag_41" value="doc"></td><td><input type="text" name="q3_etc_41" class="form-input-inline"></td></tr>
                        <tr><td colspan="4" class="table-section-title">종양(암)</td></tr>
                        <tr><td>42. 양성 종양</td><td><input type="radio" name="q3_diag_42" value="self"></td><td><input type="radio" name="q3_diag_42" value="doc"></td><td></td></tr>
                        <tr><td>43. 악성 종양(암)</td><td><input type="radio" name="q3_diag_43" value="self"></td><td><input type="radio" name="q3_diag_43" value="doc"></td><td><input type="text" name="q3_etc_43" class="form-input-inline"></td></tr>
                        <tr><td colspan="4" class="table-section-title">내분비/대사 질환</td></tr>
                        <tr><td>44. 비만</td><td><input type="radio" name="q3_diag_44" value="self"></td><td><input type="radio" name="q3_diag_44" value="doc"></td><td></td></tr>
                        <tr><td>45. 당뇨</td><td><input type="radio" name="q3_diag_45" value="self"></td><td><input type="radio" name="q3_diag_45" value="doc"></td><td></td></tr>
                        <tr><td>46. 갑상선 질환</td><td><input type="radio" name="q3_diag_46" value="self"></td><td><input type="radio" name="q3_diag_46" value="doc"></td><td></td></tr>
                        <tr><td>47. 기타 내분비/대사 질환</td><td><input type="radio" name="q3_diag_47" value="self"></td><td><input type="radio" name="q3_diag_47" value="doc"></td><td><input type="text" name="q3_etc_47" class="form-input-inline"></td></tr>
                        <tr><td colspan="4" class="table-section-title">혈액질환 및 선천성질병</td></tr>
                        <tr><td>48. 빈혈</td><td><input type="radio" name="q3_diag_48" value="self"></td><td><input type="radio" name="q3_diag_48" value="doc"></td><td></td></tr>
                        <tr><td>49. 기타 혈액 질환</td><td><input type="radio" name="q3_diag_49" value="self"></td><td><input type="radio" name="q3_diag_49" value="doc"></td><td><input type="text" name="q3_etc_49" class="form-input-inline"></td></tr>
                        <tr><td colspan="4" class="table-section-title">선천성 기형</td></tr>
                        <tr><td>50. 선천성 기형</td><td><input type="radio" name="q3_diag_50" value="self"></td><td><input type="radio" name="q3_diag_50" value="doc"></td><td></td></tr>
                        <tr><td>51. 그 이외의 질병/부상</td><td><input type="radio" name="q3_diag_51" value="self"></td><td><input type="radio" name="q3_diag_51" value="doc"></td><td><input type="text" name="q3_etc_51" class="form-input-inline"></td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Question 4 -->
        <div class="question-section" id="q4_section">
            <h2 class="question-title">4. 당신의 질병이나 부상이 현재 일을 하는데 방해가 됩니까?</h2>
            <div class="option-group">
                <label><input type="radio" name="q4_impairment" value="6"> 불편한 점이 없거나 질병/부상이 없다.</label>
                <label><input type="radio" name="q4_impairment" value="5"> 일을 할 수 있지만, 가끔 약간의 통증이 생긴다.</label>
                <label><input type="radio" name="q4_impairment" value="4"> 질병/부상으로 가끔씩 작업속도를 늦추거나 작업방법을 바꾼다.</label>
                <label><input type="radio" name="q4_impairment" value="3"> 질병/부상으로 아주 자주 작업속도를 늦추거나 작업방법을 바꾼다.</label>
                <label><input type="radio" name="q4_impairment" value="2"> 질병/부상으로 장시간 작업하는 것이 불가능하여 시간제로만 할 수 있다고 느낀다.</label>
                <label><input type="radio" name="q4_impairment" value="1"> 내 생각으로 현재 전혀 일을 할 수 없다.</label>
            </div>
        </div>

        <!-- Question 5 -->
        <div class="question-section" id="q5_section">
            <h2 class="question-title">5. 당신은 건강 문제<span style="font-size:0.8rem">(질병이나 건강관리나 검진을 위해)</span> 때문에 지난 1년 동안 직장에 나가지 못한 것은 총 몇 일입니까?</h2>
            <div class="option-group">
                <label><input type="radio" name="q5_illness_days" value="5"> 전혀 없음</label>
                <label><input type="radio" name="q5_illness_days" value="4"> 9일 이내</label>
                <label><input type="radio" name="q5_illness_days" value="3"> 10~24일</label>
                <label><input type="radio" name="q5_illness_days" value="2"> 25~99일</label>
                <label><input type="radio" name="q5_illness_days" value="1"> 100일 이상</label>
            </div>
        </div>

        <!-- Question 6 -->
        <div class="question-section" id="q6_section">
            <h2 class="question-title">6. 당신의 건강상태를 볼 때 향후 2년간 현재 직업을 계속할 수 있다고 믿습니까?</h2>
            <div class="option-group">
                <label><input type="radio" name="q6_future_ability" value="7"> 거의 확실하다</label>
                <label><input type="radio" name="q6_future_ability" value="4"> 불확실하다</label>
                <label><input type="radio" name="q6_future_ability" value="1"> 불가능할 것 같다</label>
            </div>
        </div>

        <!-- Question Group 7: 7-1, 7-2, 7-3 -->
        <div class="question-group-section" id="q7_group_section">
            <div class="question-section">
                <h2 class="question-title">7-1. 당신은 최근 매일 일상적인 활동을 즐길 수 있습니까?</h2>
                <div class="option-group">
                    <label><input type="radio" name="q7_1_enjoy" value="4"> 자주(항상)</label>
                    <label><input type="radio" name="q7_1_enjoy" value="3"> 약간 자주</label>
                    <label><input type="radio" name="q7_1_enjoy" value="2"> 가끔</label>
                    <label><input type="radio" name="q7_1_enjoy" value="1"> 다소 드물게</label>
                    <label><input type="radio" name="q7_1_enjoy" value="0"> 전혀</label>
                </div>
            </div>
            <div class="question-section">
                <h2 class="question-title">7-2. 당신은 최근 활동적이고 정신이 맑습니까?</h2>
                <div class="option-group">
                    <label><input type="radio" name="q7_2_alert" value="4"> 자주(항상)</label>
                    <label><input type="radio" name="q7_2_alert" value="3"> 약간 자주</label>
                    <label><input type="radio" name="q7_2_alert" value="2"> 가끔</label>
                    <label><input type="radio" name="q7_2_alert" value="1"> 다소 드물게</label>
                    <label><input type="radio" name="q7_2_alert" value="0"> 전혀</label>
                </div>
            </div>
            <div class="question-section">
                <h2 class="question-title">7-3. 당신은 최근 자신의 미래에 대한 희망이 충만하다고 느끼십니까?</h2>
                <div class="option-group">
                    <label><input type="radio" name="q7_3_hope" value="4"> 자주(항상)</label>
                    <label><input type="radio" name="q7_3_hope" value="3"> 약간 자주</label>
                    <label><input type="radio" name="q7_3_hope" value="2"> 가끔</label>
                    <label><input type="radio" name="q7_3_hope" value="1"> 다소 드물게</label>
                    <label><input type="radio" name="q7_3_hope" value="0"> 전혀</label>
                </div>
            </div>
        </div>

        <div class="button-container">
            <button id="calculateBtn" class="btn btn-calculate">WAI 점수 계산</button>
            <button id="resetBtn" class="btn btn-reset">선택 사항 초기화</button>
            <button id="saveBtn" class="btn btn-save">입력자료 저장</button>
            <button id="exportBtn" class="btn btn-export">엑셀/CSV로 출력</button>
        </div>

        <div id="result" class="score-display hidden">
            <h3 class="result-section-title">문항별 점수</h3>
            <div class="individual-scores">
                <p>문항 1 점수: <span id="q1_1_2_3CalculatedScoreDisplay">0</span>점 <span class="detail" id="q1_1_2_3Detail"></span></p>
                <p>문항 2 점수: <span id="q2ActualScoreDisplay">0</span>점</p>
                <p>문항 3 점수: <span id="q3ResultScore">0</span>점 <span class="detail" id="q3Detail"></span></p>
                <p>문항 4 점수: <span id="q4ResultScore">0</span>점</p>
                <p>문항 5 점수: <span id="q5ResultScore">0</span>점</p>
                <p>문항 6 점수: <span id="q6ResultScore">0</span>점</p>
                <p>문항 7 점수: <span id="q7ResultScore">0</span>점 <span class="detail" id="q7Detail"></span></p>
            </div>
            
            <p class="score-level" id="waiLevel">등급: <span id="waiScore" class="">0</span>점</p>
            <p class="text-base-gray mt-2" id="waiAction">조치/관리 방안: </p>

            <h3 class="result-section-title">WAI 등급별 점수 기준</h3>
            <table class="wai-criteria-table">
                <thead>
                    <tr><th>WAI 점수</th><th>등급(구분)</th><th>조치(관리방안)</th></tr>
                </thead>
                <tbody>
                    <tr class="excellent-row"><td>44점 이상</td><td>우수함 (Excellent)</td><td>작업수행능력 유지(Maintain)</td></tr>
                    <tr class="good-row"><td>37~43점</td><td>좋음 (Good)</td><td>작업수행능력 지지(Support)</td></tr>
                    <tr class="moderate-row"><td>28~36점</td><td>보통 (Moderate)</td><td>작업수행능력 향상(Improve)</td></tr>
                    <tr class="poor-row"><td>7~27점</td><td>부진 (Poor)</td><td>작업수행능력 회복(Restore)</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // 데이터 저장을 위한 전역 배열
        let savedData = [];

        // 버튼 이벤트 리스너 설정
        document.getElementById('calculateBtn').addEventListener('click', showCalculationResult);
        document.getElementById('saveBtn').addEventListener('click', saveData);
        document.getElementById('exportBtn').addEventListener('click', exportToCSV);
        document.getElementById('resetBtn').addEventListener('click', () => resetForm(true)); // true를 전달하여 회사명/부서명 초기화 여부 결정


        // Q3 '해당 없음' 체크박스 로직
        const q3NoDiagnosisCheckbox = document.getElementById('q3_no_diagnosis');
        const q3TableContainer = document.getElementById('q3_table_container');
        q3NoDiagnosisCheckbox.addEventListener('change', () => {
            const isDisabled = q3NoDiagnosisCheckbox.checked;
            q3TableContainer.querySelectorAll('input').forEach(input => {
                input.disabled = isDisabled;
                if (isDisabled) {
                    if (input.type === 'radio') input.checked = false;
                    if (input.type === 'text') input.value = '';
                }
            });
            q3TableContainer.style.opacity = isDisabled ? '0.5' : '1';
            q3TableContainer.style.pointerEvents = isDisabled ? 'none' : 'auto';
        });

        // 유틸리티 함수: 라디오 버튼 값 가져오기
        function getRadioValue(name) {
            const radio = document.querySelector(`input[name="${name}"]:checked`);
            return radio ? radio.value : null;
        }
        
        // 핵심 로직: WAI 점수 계산 및 데이터 수집
        function getWAIResults() {
            let errors = [];
            const results = { scores: {}, rawValues: {}, totalScore: 0 };

            // 사용자 정보 유효성 검사
            const companyName = document.getElementById('companyName').value.trim();
            const departmentName = document.getElementById('departmentName').value.trim();
            if (!companyName) errors.push("사업장명을 입력해주세요.");
            if (!departmentName) errors.push("부서(공정)명을 입력해주세요.");
            results.rawValues.companyName = companyName;
            results.rawValues.departmentName = departmentName;

            // 문항 1
            const q1_1_type = getRadioValue('q1_1_type');
            const q1_2_physical = getRadioValue('q1_2_physical');
            const q1_3_mental = getRadioValue('q1_3_mental');
            if (!q1_1_type) errors.push("문항 1-1을 선택해주세요.");
            if (!q1_2_physical) errors.push("문항 1-2를 선택해주세요.");
            if (!q1_3_mental) errors.push("문항 1-3을 선택해주세요.");
            
            let q1Score = 0;
            let q1Detail = '';
            if (q1_1_type && q1_2_physical && q1_3_mental) {
                let physicalWeight = 1.0, mentalWeight = 1.0;
                if (q1_1_type === '정신적인 일') { physicalWeight = 0.5; mentalWeight = 1.5; }
                if (q1_1_type === '육체적인 일') { physicalWeight = 1.5; mentalWeight = 0.5; }
                const rawQ1Score = (Number(q1_2_physical) * physicalWeight) + (Number(q1_3_mental) * mentalWeight);
                q1Score = Math.round(rawQ1Score);
                q1Detail = `(유형: ${q1_1_type}, 육체: ${q1_2_physical}점x${physicalWeight}, 정신: ${q1_3_mental}점x${mentalWeight} = ${rawQ1Score.toFixed(1)}점)`;
            }
            results.scores.q1 = q1Score;
            results.scores.q1Detail = q1Detail;
            results.rawValues.q1_1 = q1_1_type;
            results.rawValues.q1_2 = q1_2_physical;
            results.rawValues.q1_3 = q1_3_mental;

            // 문항 2
            const q2 = getRadioValue('q2_current_ability');
            if (!q2) errors.push("문항 2를 선택해주세요.");
            results.scores.q2 = q2 ? Number(q2) : 0;
            results.rawValues.q2 = q2;

            // 문항 3
            let q3Score = 0;
            let q3Detail = '';
            if (q3NoDiagnosisCheckbox.checked) {
                q3Score = 7;
                q3Detail = '(해당 사항 없음)';
            } else {
                const diseaseBundles = { '사고': [1,2,3,4], '근골격': [5,6,7,8,9,10], '심혈관': [11,12,13,14,15], '호흡기': [16,17,18,19,20,21,22], '정신': [23,24], '신경': [25,26,27,28], '소화기': [29,30,31,32,33,34], '비뇨생식기': [35,36,37,38], '피부': [39,40,41], '종양': [42,43], '내분비': [44,45,46,47], '혈액': [48,49], '선천성': [50], '기타': [51] };
                let diagnosedCount = 0;
                let diagnosedNames = [];
                for (const bundleName in diseaseBundles) {
                    const isDiagnosed = diseaseBundles[bundleName].some(i => getRadioValue(`q3_diag_${i}`) === 'doc');
                    if (isDiagnosed) {
                        diagnosedCount++;
                        diagnosedNames.push(bundleName);
                    }
                }
                if (diagnosedCount === 0) q3Score = 7;
                else if (diagnosedCount === 1) q3Score = 5;
                else if (diagnosedCount === 2) q3Score = 4;
                else if (diagnosedCount === 3) q3Score = 3;
                else if (diagnosedCount === 4) q3Score = 2;
                else q3Score = 1;
                q3Detail = `(의사 진단 묶음: ${diagnosedCount}개 ${diagnosedNames.length > 0 ? `[${diagnosedNames.join(', ')}]` : ''})`;
            }
            results.scores.q3 = q3Score;
            results.scores.q3Detail = q3Detail;
            results.rawValues.q3 = q3Score;

            // 문항 4, 5, 6
            const q4 = getRadioValue('q4_impairment');
            if (!q4) errors.push("문항 4를 선택해주세요.");
            results.scores.q4 = q4 ? Number(q4) : 0;
            results.rawValues.q4 = q4;

            const q5 = getRadioValue('q5_illness_days');
            if (!q5) errors.push("문항 5를 선택해주세요.");
            results.scores.q5 = q5 ? Number(q5) : 0;
            results.rawValues.q5 = q5;

            const q6 = getRadioValue('q6_future_ability');
            if (!q6) errors.push("문항 6을 선택해주세요.");
            results.scores.q6 = q6 ? Number(q6) : 0;
            results.rawValues.q6 = q6;

            // 문항 7
            const q7_1 = getRadioValue('q7_1_enjoy');
            const q7_2 = getRadioValue('q7_2_alert');
            const q7_3 = getRadioValue('q7_3_hope');
            if (q7_1 === null || q7_2 === null || q7_3 === null) errors.push("문항 7의 모든 항목을 선택해주세요.");
            
            let q7Score = 0;
            let q7Detail = '';
            if (q7_1 !== null && q7_2 !== null && q7_3 !== null) {
                const q7SubTotal = Number(q7_1) + Number(q7_2) + Number(q7_3);
                if (q7SubTotal <= 3) q7Score = 1;
                else if (q7SubTotal <= 6) q7Score = 2;
                else if (q7SubTotal <= 9) q7Score = 3;
                else q7Score = 4;
                q7Detail = `(세부문항 합계: ${q7SubTotal}점)`;
            }
            results.scores.q7 = q7Score;
            results.scores.q7Detail = q7Detail;
            results.rawValues.q7 = q7Score;

            // 총점 계산
            results.totalScore = Object.values(results.scores).filter(v => typeof v === 'number').reduce((a, b) => a + b, 0);
            results.errors = errors;

            return results;
        }

        // 기능 함수: 점수 계산 결과 표시
        function showCalculationResult() {
            const { scores, totalScore, errors } = getWAIResults();

            if (errors.length > 0) {
                displayMessage("오류: " + errors.join(', '), 'error');
                document.getElementById('result').classList.add('hidden');
                return;
            }

            // Get references to elements, checking for null
            const q1Display = document.getElementById('q1_1_2_3CalculatedScoreDisplay');
            const q1Detail = document.getElementById('q1_1_2_3Detail');
            const q2Display = document.getElementById('q2ActualScoreDisplay');
            const q3ScoreDisplay = document.getElementById('q3ResultScore');
            const q3DetailDisplay = document.getElementById('q3Detail');
            const q4ScoreDisplay = document.getElementById('q4ResultScore');
            const q5ScoreDisplay = document.getElementById('q5ResultScore');
            const q6ScoreDisplay = document.getElementById('q6ResultScore');
            const q7ScoreDisplay = document.getElementById('q7ResultScore');
            const q7DetailDisplay = document.getElementById('q7Detail');
            const waiScoreDisplay = document.getElementById('waiScore');
            const waiLevelDisplay = document.getElementById('waiLevel');
            const waiActionDisplay = document.getElementById('waiAction');
            const resultSection = document.getElementById('result');

            // Update text content only if elements exist
            if (q1Display) q1Display.textContent = scores.q1;
            if (q1Detail) q1Detail.textContent = scores.q1Detail;
            if (q2Display) q2Display.textContent = scores.q2;
            if (q3ScoreDisplay) q3ScoreDisplay.textContent = scores.q3;
            if (q3DetailDisplay) q3DetailDisplay.textContent = scores.q3Detail;
            if (q4ScoreDisplay) q4ScoreDisplay.textContent = scores.q4;
            if (q5ScoreDisplay) q5ScoreDisplay.textContent = scores.q5;
            if (q6ScoreDisplay) q6ScoreDisplay.textContent = scores.q6;
            if (q7ScoreDisplay) q7ScoreDisplay.textContent = scores.q7;
            if (q7DetailDisplay) q7DetailDisplay.textContent = scores.q7Detail;

            let level = '', action = '', levelClass = '';
            if (totalScore >= 44) { level = '우수함 (Excellent)'; action = '작업수행능력 유지'; levelClass = 'excellent'; }
            else if (totalScore >= 37) { level = '좋음 (Good)'; action = '작업수행능력 지지'; levelClass = 'good'; }
            else if (totalScore >= 28) { level = '보통 (Moderate)'; action = '작업수행능력 향상'; levelClass = 'moderate'; }
            else { level = '부진 (Poor)'; action = '작업수행능력 회복'; levelClass = 'poor'; }

            if (waiScoreDisplay) {
                waiScoreDisplay.textContent = totalScore;
                waiScoreDisplay.className = levelClass;
            }
            if (waiLevelDisplay) {
                waiLevelDisplay.innerHTML = `등급: ${level} (총 WAI 점수: ${totalScore}점)`;
                waiLevelDisplay.className = `score-level ${levelClass}`;
            }
            if (waiActionDisplay) waiActionDisplay.textContent = `조치/관리 방안: ${action}`;
            
            if (resultSection) {
                resultSection.classList.remove('hidden');
                window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
            }
        }

        // 기능 함수: 데이터 저장
        function saveData() {
            const { rawValues, totalScore, errors } = getWAIResults();
            if (errors.length > 0) {
                displayMessage("저장 실패: " + errors.join(', '), 'error');
                return;
            }

            const dataEntry = {
                company: rawValues.companyName,
                department: rawValues.departmentName,
                q1_1: rawValues.q1_1,
                q1_2: rawValues.q1_2,
                q1_3: rawValues.q1_3,
                q2: rawValues.q2,
                q3: rawValues.q3,
                q4: rawValues.q4,
                q5: rawValues.q5,
                q6: rawValues.q6,
                q7: rawValues.q7,
                waiTotal: totalScore
            };
            
            savedData.push(dataEntry);
            displayMessage(`데이터가 저장되었습니다. (총 ${savedData.length}개)`);
            // 데이터 저장 후, 회사명과 부서명은 유지하고 나머지 필드만 초기화
            resetForm(false); 
            // 결과 섹션이 숨겨지지 않도록 hidden 클래스 제거 (이미 showCalculationResult에서 처리됨)
            document.getElementById('result').classList.remove('hidden');
        }

        // 기능 함수: CSV로 내보내기
        function exportToCSV() {
            if (savedData.length === 0) {
                displayMessage("내보낼 데이터가 없습니다.", 'error');
                return;
            }

            const headers = [
                "사업장명", "부서명", 
                "1-1.작업형태", "1-2.육체업무능력(점수)", "1-3.정신업무능력(점수)",
                "2.현재작업능력(점수)", "3.질병(점수)", "4.업무방해(점수)",
                "5.결근일수(점수)", "6.향후작업능력(점수)", "7.정신적자원(점수)",
                "WAI 총점"
            ];
            
            const dataKeys = Object.keys(savedData[0]);
            let csvContent = "\uFEFF" + headers.join(',') + '\n';

            savedData.forEach(row => {
                const values = dataKeys.map(key => {
                    let value = row[key];
                    if (typeof value === 'string' && value.includes(',')) {
                        return `"${value}"`;
                    }
                    return value;
                });
                csvContent += values.join(',') + '\n';
            });

            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement("a");
            const url = URL.createObjectURL(blob);
            link.setAttribute("href", url);
            link.setAttribute("download", "wai_data.csv");
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // 기능 함수: 폼 초기화
        // keepCompanyNameAndDepartment: true이면 사업장명과 부서명을 초기화하고, false이면 유지
        function resetForm(keepCompanyNameAndDepartment = false) {
            const container = document.querySelector('.container');
            
            // 모든 텍스트 입력 필드 초기화 (사업장명, 부서명 제외)
            container.querySelectorAll('input[type="text"]').forEach(input => {
                if (keepCompanyNameAndDepartment || (input.id !== 'companyName' && input.id !== 'departmentName')) {
                    input.value = '';
                }
            });
            
            // 모든 라디오 버튼 및 체크박스 선택 해제
            container.querySelectorAll('input[type="radio"], input[type="checkbox"]').forEach(input => input.checked = false);
            
            // Q3 '해당 없음' 체크박스 상태 변경에 따른 테이블 UI 업데이트
            // 체크 해제 후 change 이벤트를 발생시켜 테이블을 다시 활성화합니다.
            const q3NoDiagnosisCheckbox = document.getElementById('q3_no_diagnosis');
            q3NoDiagnosisCheckbox.dispatchEvent(new Event('change'));

            // 결과 섹션 숨기기
            document.getElementById('result').classList.add('hidden');
            
            // 사업장명 필드에 포커스
            document.getElementById('companyName').focus();
        }
        
        // 커스텀 메시지 박스
        function displayMessage(message, type = 'info') {
            let messageBox = document.getElementById('messageBox');
            if (!messageBox) {
                messageBox = document.createElement('div');
                messageBox.id = 'messageBox';
                messageBox.className = 'fixed-message-box';
                document.body.appendChild(messageBox);
            }

            messageBox.textContent = message;
            messageBox.style.backgroundColor = type === 'error' ? '#e74c3c' : '#28a745';
            messageBox.style.display = 'block';

            setTimeout(() => {
                messageBox.style.display = 'none';
            }, 3000);
        }
    });
    </script>
</body>
</html>
